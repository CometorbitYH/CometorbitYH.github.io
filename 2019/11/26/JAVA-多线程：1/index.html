<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>JAVA 多线程：1 | MY</title><meta name="description" content="JAVA 多线程：1"><meta name="keywords" content><meta name="author" content="杨涵"><meta name="copyright" content="杨涵"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="canonical" href="https://cometorbityh.github.io/2019/11/26/JAVA-多线程：1/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="JAVA 多线程：1"><meta name="twitter:description" content="JAVA 多线程：1"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/Photo/avatar.png"><meta property="og:type" content="article"><meta property="og:title" content="JAVA 多线程：1"><meta property="og:url" content="https://cometorbityh.github.io/2019/11/26/JAVA-多线程：1/"><meta property="og:site_name" content="MY"><meta property="og:description" content="JAVA 多线程：1"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/Photo/avatar.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="next" title="数据库" href="https://cometorbityh.github.io/2019/11/25/数据库/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight_copy: 'true',
  highlight_lang: 'true',
  highlight_shrink: 'false',
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: '添加书签',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  copyright: {"languages":{"author":"作者: 杨涵","link":"链接: https://cometorbityh.github.io/2019/11/26/JAVA-多线程：1/","source":"来源: MY","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  copy_copyright_js: true
  
}</script></head><body><canvas class="fireworks"></canvas><div id="header"> <div id="page-header"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">MY</a></span><i class="fa fa-bars fa-fw toggle-menu pull-right close" aria-hidden="true"></i><span class="pull-right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> List</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div><script>document.body.addEventListener('touchstart', function(){ });</script></div></span><span class="pull-right" id="search_button"></span></div></div><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="lozad avatar_img" src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/Photo/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'"></div><div class="mobile_post_data"><div class="mobile_data_item is_center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">51</div></a></div></div><div class="mobile_data_item is_center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">16</div></a></div></div><div class="mobile_data_item is_center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">9</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> List</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div><script>document.body.addEventListener('touchstart', function(){ });</script></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#多线程"><span class="toc_mobile_items-text">多线程</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#线程的创建-启动"><span class="toc_mobile_items-text">线程的创建 + 启动</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#方式一-继承Thread类"><span class="toc_mobile_items-text">方式一  继承Thread类</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#Thread常用的方法"><span class="toc_mobile_items-text">Thread常用的方法</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#方式二-实现Runnable接口"><span class="toc_mobile_items-text">方式二  实现Runnable接口</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#—-匿名内部类在线程中的使用"><span class="toc_mobile_items-text">—- 匿名内部类在线程中的使用</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#—-提取线程"><span class="toc_mobile_items-text">—- 提取线程</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#方式三-实现Callable接口"><span class="toc_mobile_items-text">方式三  实现Callable接口</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#线程的生命周期"><span class="toc_mobile_items-text">线程的生命周期</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#线程控制的几个方法"><span class="toc_mobile_items-text">线程控制的几个方法</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#setName-setPriority"><span class="toc_mobile_items-text">setName( ),    setPriority( )</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#join"><span class="toc_mobile_items-text">join( )</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#sleep"><span class="toc_mobile_items-text">sleep()</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#yield-：礼让"><span class="toc_mobile_items-text">yield()：礼让</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#setDaemon-true-：后台线程-寄生线程"><span class="toc_mobile_items-text">setDaemon(true)：后台线程/寄生线程</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#interrupt"><span class="toc_mobile_items-text">interrupt()</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#stop-（不推荐使用）"><span class="toc_mobile_items-text">stop()*（不推荐使用）</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#线程同步"><span class="toc_mobile_items-text">线程同步</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#同步代码块"><span class="toc_mobile_items-text">同步代码块</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#同步代码块的执行过程"><span class="toc_mobile_items-text">同步代码块的执行过程</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#同步代码块的优缺点"><span class="toc_mobile_items-text">同步代码块的优缺点</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#其他"><span class="toc_mobile_items-text">其他</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#同步方法"><span class="toc_mobile_items-text">同步方法</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#Lock锁"><span class="toc_mobile_items-text">Lock锁</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#Lock-和-synchronized-的区别"><span class="toc_mobile_items-text">Lock 和 synchronized 的区别</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#优先使用顺序"><span class="toc_mobile_items-text">优先使用顺序</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#线程通信"><span class="toc_mobile_items-text">线程通信</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#生产者和消费者问题"><span class="toc_mobile_items-text">生产者和消费者问题</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#更完整的线程生命周期"><span class="toc_mobile_items-text">更完整的线程生命周期</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#生产者-消费者（同步方法）"><span class="toc_mobile_items-text">生产者 消费者（同步方法）</span></a></li></ol></li></ol></div></div><div id="body-wrap"><div id="web_bg"></div><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#多线程"><span class="toc-text">多线程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#线程的创建-启动"><span class="toc-text">线程的创建 + 启动</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#方式一-继承Thread类"><span class="toc-text">方式一  继承Thread类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Thread常用的方法"><span class="toc-text">Thread常用的方法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#方式二-实现Runnable接口"><span class="toc-text">方式二  实现Runnable接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#—-匿名内部类在线程中的使用"><span class="toc-text">—- 匿名内部类在线程中的使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#—-提取线程"><span class="toc-text">—- 提取线程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#方式三-实现Callable接口"><span class="toc-text">方式三  实现Callable接口</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#线程的生命周期"><span class="toc-text">线程的生命周期</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#线程控制的几个方法"><span class="toc-text">线程控制的几个方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#setName-setPriority"><span class="toc-text">setName( ),    setPriority( )</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#join"><span class="toc-text">join( )</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sleep"><span class="toc-text">sleep()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#yield-：礼让"><span class="toc-text">yield()：礼让</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#setDaemon-true-：后台线程-寄生线程"><span class="toc-text">setDaemon(true)：后台线程/寄生线程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#interrupt"><span class="toc-text">interrupt()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#stop-（不推荐使用）"><span class="toc-text">stop()*（不推荐使用）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#线程同步"><span class="toc-text">线程同步</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#同步代码块"><span class="toc-text">同步代码块</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#同步代码块的执行过程"><span class="toc-text">同步代码块的执行过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#同步代码块的优缺点"><span class="toc-text">同步代码块的优缺点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#其他"><span class="toc-text">其他</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#同步方法"><span class="toc-text">同步方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lock锁"><span class="toc-text">Lock锁</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lock-和-synchronized-的区别"><span class="toc-text">Lock 和 synchronized 的区别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#优先使用顺序"><span class="toc-text">优先使用顺序</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#线程通信"><span class="toc-text">线程通信</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#生产者和消费者问题"><span class="toc-text">生产者和消费者问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#更完整的线程生命周期"><span class="toc-text">更完整的线程生命周期</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#生产者-消费者（同步方法）"><span class="toc-text">生产者 消费者（同步方法）</span></a></li></ol></li></ol></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/Photo/post.png)"><div id="post-info"><div id="post-title"><div class="posttitle">JAVA 多线程：1</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2019-11-26<span class="post-meta__separator">|</span><i class="fa fa-history" aria-hidden="true"></i> 更新于 2019-11-28</time><div class="post-meta-wordcount"><span>阅读量: </span><span id="busuanzi_value_page_pv"></span></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><h1 id="多线程"><a href="#多线程" class="headerlink" title="多线程"></a>多线程</h1><h2 id="线程的创建-启动"><a href="#线程的创建-启动" class="headerlink" title="线程的创建 + 启动"></a>线程的创建 + 启动</h2><p>方式1：继承 java.lang.Thread 类，并覆盖run( ) 方法<br>方式2：实现 java.lang.Runnble 类，并实现run( )方法<br>方式3：实现 Callable 接口，并实现call( )方法</p>
<p><img alt data-src="https://yanghanblog.oss-cn-hangzhou.aliyuncs.com/img/20191126211351.png" class="lozad"></p>
<blockquote>
<p> tips：<strong>我们常写的main方法也是一个线程</strong>，称为”<strong>主线程</strong>“</p>
</blockquote>
<p><strong>线程启动的步骤：</strong></p>
<ul>
<li>创建线程类，重写 run( ) 方法</li>
<li>创建线程对象</li>
<li>启动该线程，start( ) 方法（注意不是执行 run 方法）</li>
</ul>
<h3 id="方式一-继承Thread类"><a href="#方式一-继承Thread类" class="headerlink" title="方式一  继承Thread类"></a>方式一  继承Thread类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadDemo</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 方法体，run()中写的是线程执行的代码，线程要完成的任务</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//由于继承了Thread类，可以直接用this调用线程的方法</span></span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">"当前线程名："</span>+<span class="keyword">this</span>.getName()+<span class="string">",线程优先级："</span>+<span class="keyword">this</span>.getPriority());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//创建线程对象</span></span><br><span class="line">        ThreadDemo thread = <span class="keyword">new</span> ThreadDemo();</span><br><span class="line">        <span class="comment">//启动线程</span></span><br><span class="line">        thread.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// main线程</span></span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">"当前线程名："</span>+Thread.currentThread().getName()+<span class="string">"，线程优先级："</span>+Thread.currentThread().getPriority());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//设定主线程优先级</span></span><br><span class="line">        <span class="comment">//Thread.currentThread().setPriority(Thread.MAX_PRIORITY);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">--------------------------</span><br><span class="line">当前线程名：main，线程优先级：<span class="number">5</span></span><br><span class="line">当前线程名：main，线程优先级：<span class="number">5</span></span><br><span class="line">当前线程名：main，线程优先级：<span class="number">5</span></span><br><span class="line">当前线程名：Thread-<span class="number">0</span>,线程优先级：<span class="number">5</span></span><br><span class="line">当前线程名：Thread-<span class="number">0</span>,线程优先级：<span class="number">5</span></span><br><span class="line">当前线程名：Thread-<span class="number">0</span>,线程优先级：<span class="number">5</span></span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<h4 id="Thread常用的方法"><a href="#Thread常用的方法" class="headerlink" title="Thread常用的方法"></a>Thread常用的方法</h4><blockquote>
<p>run() —— 线程体</p>
<p>start( ) —— 启动线程</p>
<p>currentThread( ) —— 获取当前线程</p>
<p>** getName() —— 获取线程名称</p>
<p>** setName() —— 设置线程名称</p>
<p>** getPriority() —— 获取线程优先级</p>
<p>** setPriority() —— 设置线程优先级</p>
<p>优先级级别越低，代表执行的几率越小，但不是没有</p>
</blockquote>
<h3 id="方式二-实现Runnable接口"><a href="#方式二-实现Runnable接口" class="headerlink" title="方式二  实现Runnable接口"></a>方式二  实现Runnable接口</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RunnableDemo</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 方法体，run()中写的是线程执行的代码，线程要完成的任务</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//由于继承了Thread类，可以直接用this调用线程的方法</span></span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">"当前线程名："</span>+Thread.currentThread().getName()+<span class="string">",线程优先级："</span>+Thread.currentThread().getPriority());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//创建线程对象</span></span><br><span class="line">        Runnable r = <span class="keyword">new</span> RunnableDemo();	<span class="comment">//这并不是个线程对象</span></span><br><span class="line">        Thread thread = <span class="keyword">new</span> Thread(r);	<span class="comment">//这才是线程对象</span></span><br><span class="line">        <span class="comment">//启动线程</span></span><br><span class="line">        thread.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// main线程</span></span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">"当前线程名："</span>+Thread.currentThread().getName()+<span class="string">"，线程优先级："</span>+Thread.currentThread().getPriority());</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2种定义线程类的方法的对比</strong></p>
<table>
<thead>
<tr>
<th></th>
<th>Thread类</th>
<th>Runnable接口</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>编程相对简单</td>
<td>编程相对复杂</td>
</tr>
<tr>
<td>2</td>
<td>Thread是个类，因此线程类无法继承其他类</td>
<td>Runnable是个接口，因此线程类还可以继承其他类</td>
</tr>
<tr>
<td>3</td>
<td>多个线程共享同一个资源</td>
<td><strong>更方便</strong>多个线程共享同一个资源</td>
</tr>
</tbody></table>
<p>上述3的举例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 创建线程对象</span></span><br><span class="line">        Runnable r = <span class="keyword">new</span> RunnableDemo();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 多个Thread对象共用同一个RunnableDemo</span></span><br><span class="line">        Thread thread1 = <span class="keyword">new</span> Thread(r);</span><br><span class="line">        Thread thread2 = <span class="keyword">new</span> Thread(r);</span><br><span class="line">        Thread thread3 = <span class="keyword">new</span> Thread(r);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 启动线程</span></span><br><span class="line">        thread1.start();</span><br><span class="line">        thread2.start();</span><br><span class="line">        thread3.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// main线程</span></span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">"当前线程名："</span>+Thread.currentThread().getName()+<span class="string">"，线程优先级："</span>+Thread.currentThread().getPriority());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样，假如在线程类中售卖200张票。如果启动了3个对象，就相当于是3个窗口交替的在给你卖票，这样效率就特别快了。</p>
<h3 id="—-匿名内部类在线程中的使用"><a href="#—-匿名内部类在线程中的使用" class="headerlink" title="—- 匿名内部类在线程中的使用"></a>—- 匿名内部类在线程中的使用</h3><p>如果某个Runnable接口的实现类只使用一次，使用匿名内部类即可</p>
<p>多个Thread对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo1</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建线程对象</span></span><br><span class="line">        Runnable r = <span class="keyword">new</span> Runnable()&#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">                    System.out.println(<span class="string">"当前线程名："</span>+Thread.currentThread().getName()+<span class="string">",线程优先级："</span>+Thread.currentThread().getPriority());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 多个Thread对象共用同一个Runnable对象</span></span><br><span class="line">        Thread thread1 = <span class="keyword">new</span> Thread(r);</span><br><span class="line">        Thread thread2 = <span class="keyword">new</span> Thread(r);</span><br><span class="line">        Thread thread3 = <span class="keyword">new</span> Thread(r);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 启动线程</span></span><br><span class="line">        thread1.start();</span><br><span class="line">        thread2.start();</span><br><span class="line">        thread3.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// main线程</span></span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">"当前线程名："</span>+Thread.currentThread().getName()+<span class="string">"，线程优先级："</span>+Thread.currentThread().getPriority());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>单个Thread对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo1</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建线程对象</span></span><br><span class="line"></span><br><span class="line">        Thread thread1 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">                    System.out.println(<span class="string">"当前线程名："</span>+Thread.currentThread().getName()+<span class="string">",线程优先级："</span>+Thread.currentThread().getPriority());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 启动线程</span></span><br><span class="line">        thread1.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// main线程</span></span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">"当前线程名："</span>+Thread.currentThread().getName()+<span class="string">"，线程优先级："</span>+Thread.currentThread().getPriority());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="—-提取线程"><a href="#—-提取线程" class="headerlink" title="—- 提取线程"></a>—- 提取线程</h3><p>如果多定义几个线程类，但仅仅只是其中的名字不一样时，这是我们可以考虑用bean来封装一个通用类，这个类继承自Thread类，重写run（）方法，并且可以传入线程名和其他数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RunnerThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String RunnerName;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RunnerThread</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RunnerThread</span><span class="params">(String runnerName)</span> </span>&#123;    <span class="comment">//指定运动员名字</span></span><br><span class="line">        RunnerName = runnerName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RunnerThread</span><span class="params">(String name, String runnerName)</span> </span>&#123;   <span class="comment">//指定运动员名字 和 线程名字</span></span><br><span class="line">        <span class="keyword">super</span>(name);</span><br><span class="line">        RunnerName = runnerName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getRunnerName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> RunnerName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRunnerName</span><span class="params">(String runnerName)</span> </span>&#123;</span><br><span class="line">        RunnerName = runnerName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.run();</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line">            System.out.println(<span class="keyword">this</span>.RunnerName + <span class="string">"领先！TA的线程（赛道）是"</span>+<span class="keyword">this</span>.getName());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo1</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        RunnerThread t1 = <span class="keyword">new</span> RunnerThread();</span><br><span class="line">        t1.setRunnerName(<span class="string">"刘翔"</span>);</span><br><span class="line">        t1.setName(<span class="string">"刘翔线程"</span>);</span><br><span class="line"></span><br><span class="line">        Thread t2 = <span class="keyword">new</span> RunnerThread(<span class="string">"可达鸭"</span>);</span><br><span class="line"></span><br><span class="line">        Thread t3 = <span class="keyword">new</span> RunnerThread(<span class="string">"姚明线程"</span>,<span class="string">"姚明"</span>);</span><br><span class="line"></span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        t3.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">-------------------------------</span><br><span class="line">刘翔领先！TA的线程（赛道）是刘翔线程</span><br><span class="line">刘翔领先！TA的线程（赛道）是刘翔线程</span><br><span class="line">刘翔领先！TA的线程（赛道）是刘翔线程</span><br><span class="line">刘翔领先！TA的线程（赛道）是刘翔线程</span><br><span class="line">可达鸭领先！TA的线程（赛道）是Thread-<span class="number">1</span></span><br><span class="line">可达鸭领先！TA的线程（赛道）是Thread-<span class="number">1</span></span><br><span class="line">姚明领先！TA的线程（赛道）是姚明线程</span><br></pre></td></tr></table></figure>

<h3 id="方式三-实现Callable接口"><a href="#方式三-实现Callable接口" class="headerlink" title="方式三  实现Callable接口"></a>方式三  实现Callable接口</h3><h2 id="线程的生命周期"><a href="#线程的生命周期" class="headerlink" title="线程的生命周期"></a>线程的生命周期</h2><p>CPU只有一个，必须抢占，若抢占不到，就要排队</p>
<p>就绪状态也称可运行状态，可以运行但是还没资格运行</p>
<p><img alt data-src="https://yanghanblog.oss-cn-hangzhou.aliyuncs.com/img/20191127002034.jpg" class="lozad"></p>
<p><img alt data-src="https://yanghanblog.oss-cn-hangzhou.aliyuncs.com/img/20191127002302.png" class="lozad"></p>
<h2 id="线程控制的几个方法"><a href="#线程控制的几个方法" class="headerlink" title="线程控制的几个方法"></a>线程控制的几个方法</h2><h3 id="setName-setPriority"><a href="#setName-setPriority" class="headerlink" title="setName( ),    setPriority( )"></a>setName( ),    setPriority( )</h3><blockquote>
<p>可以在线程类中设定，也可以在start()之前设定</p>
</blockquote>
<blockquote>
<p>Java提供了一个<strong>线程调度器</strong>，来监控程序中启动后并进入就绪状态的所有线程，线程调度器会按照线程的优先级决定应调度哪个线程来执行。</p>
</blockquote>
<p>线程优先级用数字表示，范围在[0,10]</p>
<p>注意：优先级低只是意味着<strong>获得调度的概率低</strong>，并不是绝对先调用优先级高后调用优先级低的线程</p>
<h3 id="join"><a href="#join" class="headerlink" title="join( )"></a>join( )</h3><blockquote>
<p>作用：阻塞当前正在运行的线程，插入本线程，等本线程执行完毕后，再执行被阻塞的线程</p>
<p>简而言之：某个线程被本少爷<strong>中断了（插队了）</strong></p>
</blockquote>
<p><strong>注意：join() 必须写在 start() 之后</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RunnableDemo</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(i&lt;<span class="number">6</span>)&#123;</span><br><span class="line">            System.out.println(i+<span class="string">"  从线程："</span>+Thread.currentThread().getName()+<span class="string">"---"</span>+Thread.currentThread().getPriority());</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo1</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(i&lt;<span class="number">10</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i==<span class="number">4</span>)&#123;</span><br><span class="line">                <span class="comment">//另一个线程对象</span></span><br><span class="line">                Thread t1 = <span class="keyword">new</span> RunnableDemo();</span><br><span class="line">                t1.setName();</span><br><span class="line">                t1.start();</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    t1.join();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(i+<span class="string">"  主线程："</span>+ Thread.currentThread().getName() +<span class="string">"---"</span> +Thread.currentThread().getPriority());</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">--------------------------------</span><br><span class="line"><span class="number">0</span>  主线程：main---<span class="number">5</span></span><br><span class="line"><span class="number">1</span>  主线程：main---<span class="number">5</span></span><br><span class="line"><span class="number">2</span>  主线程：main---<span class="number">5</span></span><br><span class="line"><span class="number">3</span>  主线程：main---<span class="number">5</span></span><br><span class="line"><span class="number">0</span>  从线程：我是被阻塞的线程---<span class="number">5</span></span><br><span class="line"><span class="number">1</span>  从线程：我是被阻塞的线程---<span class="number">5</span></span><br><span class="line"><span class="number">2</span>  从线程：我是被阻塞的线程---<span class="number">5</span></span><br><span class="line"><span class="number">3</span>  从线程：我是被阻塞的线程---<span class="number">5</span></span><br><span class="line"><span class="number">4</span>  从线程：我是被阻塞的线程---<span class="number">5</span></span><br><span class="line"><span class="number">5</span>  从线程：我是被阻塞的线程---<span class="number">5</span></span><br><span class="line"><span class="number">4</span>  主线程：main---<span class="number">5</span></span><br><span class="line"><span class="number">5</span>  主线程：main---<span class="number">5</span></span><br><span class="line"><span class="number">6</span>  主线程：main---<span class="number">5</span></span><br><span class="line"><span class="number">7</span>  主线程：main---<span class="number">5</span></span><br><span class="line"><span class="number">8</span>  主线程：main---<span class="number">5</span></span><br><span class="line"><span class="number">9</span>  主线程：main---<span class="number">5</span></span><br></pre></td></tr></table></figure>

<h3 id="sleep"><a href="#sleep" class="headerlink" title="sleep()"></a>sleep()</h3><blockquote>
<p>作用：阻塞当前线程，让当前线程进入阻塞状态（让出CPU执行权），时间一到，线程会进入就绪状态（并不是运行状态）</p>
<p>在被阻塞的时间内，就算CPU处于空闲，被sleep的线程也不会提前结束阻塞状态，也无法获取到CPU的执行权</p>
</blockquote>
<blockquote>
<p>应用</p>
<p>在多线程环境下，模拟线程的切换，让某些安全的问题得以充分的暴露</p>
</blockquote>
<p>从线程每执行一次，就会sleep1毫秒，在这1毫秒内，主线程获取到主线程的执行权，在1毫秒内执行了很多次，等到1毫秒后，CPU的执行权又要受到争夺。也就是说，就算被阻塞的线程sleep之后，也不一定会立即得到CPU执行权，也是要重新抢占CPU的执行权。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RunnableDemo</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                sleep(<span class="number">1</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">"从线程："</span>+Thread.currentThread().getName()+<span class="string">"---"</span>+Thread.currentThread().getPriority());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo1</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//另一个线程对象</span></span><br><span class="line">        Thread t1 = <span class="keyword">new</span> RunnableDemo();</span><br><span class="line">        t1.setName(<span class="string">"我是sleep的线程"</span>);</span><br><span class="line">        t1.start();</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">"主线程："</span>+ Thread.currentThread().getName() +<span class="string">"---"</span> +Thread.currentThread().getPriority());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">------------------------------------</span><br><span class="line">主线程：main---<span class="number">5</span></span><br><span class="line">主线程：main---<span class="number">5</span></span><br><span class="line">主线程：main---<span class="number">5</span></span><br><span class="line">主线程：main---<span class="number">5</span></span><br><span class="line">从线程：我是sleep的线程---<span class="number">5</span></span><br><span class="line">主线程：main---<span class="number">5</span></span><br><span class="line">主线程：main---<span class="number">5</span></span><br><span class="line">主线程：main---<span class="number">5</span></span><br><span class="line">主线程：main---<span class="number">5</span></span><br><span class="line">主线程：main---<span class="number">5</span></span><br><span class="line">主线程：main---<span class="number">5</span></span><br><span class="line">主线程：main---<span class="number">5</span></span><br><span class="line">主线程：main---<span class="number">5</span></span><br><span class="line">主线程：main---<span class="number">5</span></span><br><span class="line">主线程：main---<span class="number">5</span></span><br><span class="line">主线程：main---<span class="number">5</span></span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<h3 id="yield-：礼让"><a href="#yield-：礼让" class="headerlink" title="yield()：礼让"></a>yield()：礼让</h3><p>field，原义屈服，投降，在此处翻译为“礼让”，礼让CPU。</p>
<p>使当前线程释放CPU，进入就绪状态，重新排队，抢占CPU执行权。</p>
<p>作用：让同优先级或更高级别的线程得到执行的机会。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RunnableDemo</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            Thread.yield();</span><br><span class="line">            System.out.println(<span class="string">"从线程："</span>+Thread.currentThread().getName()+<span class="string">"---"</span>+Thread.currentThread().getPriority());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo1</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//另一个线程对象</span></span><br><span class="line">        Thread t1 = <span class="keyword">new</span> RunnableDemo();</span><br><span class="line">        t1.setName(<span class="string">"我是sleep的线程"</span>);</span><br><span class="line">        t1.start();</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            Thread.yield();</span><br><span class="line">            System.out.println(<span class="string">"主线程："</span>+ Thread.currentThread().getName() +<span class="string">"---"</span> +Thread.currentThread().getPriority());</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">-------------------------------------</span><br><span class="line">主线程：main---<span class="number">5</span></span><br><span class="line">主线程：main---<span class="number">5</span></span><br><span class="line">主线程：main---<span class="number">5</span></span><br><span class="line">主线程：main---<span class="number">5</span></span><br><span class="line">从线程：我是sleep的线程---<span class="number">5</span></span><br><span class="line">主线程：main---<span class="number">5</span></span><br><span class="line">从线程：我是sleep的线程---<span class="number">5</span></span><br><span class="line">主线程：main---<span class="number">5</span></span><br><span class="line">从线程：我是sleep的线程---<span class="number">5</span></span><br><span class="line">主线程：main---<span class="number">5</span></span><br><span class="line">主线程：main---<span class="number">5</span></span><br></pre></td></tr></table></figure>

<h3 id="setDaemon-true-：后台线程-寄生线程"><a href="#setDaemon-true-：后台线程-寄生线程" class="headerlink" title="setDaemon(true)：后台线程/寄生线程"></a>setDaemon(true)：后台线程/寄生线程</h3><p>从线程是在main方法中定义的，实际上当主线程执行完毕后，从线程还在执行，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">----</span><br><span class="line">主线程：main---<span class="number">5</span></span><br><span class="line">主线程：main---<span class="number">5</span></span><br><span class="line">主线程：main---<span class="number">5</span></span><br><span class="line">主线程：main---<span class="number">5</span></span><br><span class="line">主线程：main---<span class="number">5</span></span><br><span class="line">主线程：main---<span class="number">5</span></span><br><span class="line">从线程：我是从线程---<span class="number">5</span></span><br><span class="line">从线程：我是从线程---<span class="number">5</span></span><br><span class="line">从线程：我是从线程---<span class="number">5</span></span><br><span class="line">从线程：我是从线程---<span class="number">5</span></span><br></pre></td></tr></table></figure>

<p>那么现在有一个需求，就是当主线程执行完毕后，从线程也不再执行（就好比寄生物一般，主体死亡，寄生物也跟着消失）</p>
<p>此时就要要到 Thread类的 setDaemon(true) 方法了</p>
<blockquote>
<p>setDaemon(true)</p>
<p>作用：使当前线程变成后台线程（寄生线程），启动后台线程的线程结束时，后台线程也随之结束</p>
<p>注意：该方法也应该定义在start()方法之前，即只能在线程启动之前将其设定为后台线程</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RunnableDemo</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">"从线程："</span>+Thread.currentThread().getName()+<span class="string">"---"</span>+Thread.currentThread().getPriority());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo1</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//另一个线程对象</span></span><br><span class="line">        Thread t1 = <span class="keyword">new</span> RunnableDemo();</span><br><span class="line">        t1.setName(<span class="string">"我是从线程"</span>);</span><br><span class="line">        t1.setDaemon(<span class="keyword">true</span>);</span><br><span class="line">        t1.start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(i&lt;<span class="number">6</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">"主线程："</span>+ Thread.currentThread().getName() +<span class="string">"---"</span> +Thread.currentThread().getPriority());</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">--------------------------------------</span><br><span class="line">主线程：main---<span class="number">5</span></span><br><span class="line">从线程：我是从线程---<span class="number">5</span></span><br><span class="line">主线程：main---<span class="number">5</span></span><br><span class="line">从线程：我是从线程---<span class="number">5</span></span><br><span class="line">主线程：main---<span class="number">5</span></span><br><span class="line">从线程：我是从线程---<span class="number">5</span></span><br><span class="line">主线程：main---<span class="number">5</span></span><br><span class="line">从线程：我是从线程---<span class="number">5</span></span><br><span class="line">主线程：main---<span class="number">5</span></span><br><span class="line">从线程：我是从线程---<span class="number">5</span></span><br><span class="line">主线程：main---<span class="number">5</span></span><br><span class="line">从线程：我是从线程---<span class="number">5</span></span><br><span class="line">从线程：我是从线程---<span class="number">5</span></span><br><span class="line">从线程：我是从线程---<span class="number">5</span></span><br></pre></td></tr></table></figure>

<p>可以看到结果，主线程执行完后，从线程也会渐渐的停止执行（多出的几次是误差，可忽略不计）</p>
<h3 id="interrupt"><a href="#interrupt" class="headerlink" title="interrupt()"></a>interrupt()</h3><p>中断线程（软中断）：不直接中断线程，而是需要被中断线程自己处理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RunnableDemo</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 线程未被中断时，执行</span></span><br><span class="line">        <span class="keyword">while</span>(!<span class="keyword">this</span>.isInterrupted())&#123;</span><br><span class="line">            System.out.println(<span class="string">"从线程："</span>+Thread.currentThread().getName()+<span class="string">"---"</span>+Thread.currentThread().getPriority());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo1</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//另一个线程对象</span></span><br><span class="line">        Thread t1 = <span class="keyword">new</span> RunnableDemo();</span><br><span class="line">        t1.setName(<span class="string">"我是从线程"</span>);</span><br><span class="line">        t1.setDaemon(<span class="keyword">true</span>);</span><br><span class="line">        t1.start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(i&lt;<span class="number">6</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">"主线程："</span>+ Thread.currentThread().getName() +<span class="string">"---"</span> +Thread.currentThread().getPriority());</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 当主线程执行完毕时， 中断从线程</span></span><br><span class="line">        t1.interrupt();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">---------------------------------</span><br><span class="line">主线程：main---<span class="number">5</span></span><br><span class="line">主线程：main---<span class="number">5</span></span><br><span class="line">主线程：main---<span class="number">5</span></span><br><span class="line">从线程：我是从线程---<span class="number">5</span></span><br><span class="line">主线程：main---<span class="number">5</span></span><br><span class="line">从线程：我是从线程---<span class="number">5</span></span><br><span class="line">主线程：main---<span class="number">5</span></span><br><span class="line">从线程：我是从线程---<span class="number">5</span></span><br><span class="line">主线程：main---<span class="number">5</span>			<span class="comment">//此时主线程执行完毕，中断从线程</span></span><br><span class="line">从线程：我是从线程---<span class="number">5</span></span><br></pre></td></tr></table></figure>

<h3 id="stop-（不推荐使用）"><a href="#stop-（不推荐使用）" class="headerlink" title="stop()*（不推荐使用）"></a>stop()*（不推荐使用）</h3><p>中断线程（硬中断）：直接结束线程</p>
<h1 id="线程同步"><a href="#线程同步" class="headerlink" title="线程同步"></a>线程同步</h1><p>当多个线程访问通过一个数据时，容易出现线程安全问题，需要让线程同步，保证数据安全</p>
<p>线程同步：当2个及2个以上的线程同时访问同一个资源时，需要某种方式来确保资源在<strong>某一个时刻只被一个线程使用</strong></p>
<p><strong>线程同步的实现方案</strong></p>
<ul>
<li><p>同步代码块</p>
<p><code>synchronized(obj){}</code></p>
</li>
<li><p>同步方法</p>
<p><code>private synchronized void XXX(){}</code></p>
</li>
</ul>
<p><strong>案例引导</strong></p>
<blockquote>
<p>需求：多用户同时操作统一账户取款，保证账户金额不出现错误</p>
<p>分析：</p>
<ul>
<li><p>多个用户对同一个账户取款，因此开发一个账户类</p>
</li>
<li><p>多用户取款操作流程一样，因此开发一个取款线程类</p>
</li>
<li><p>每个用户对应一个线程对象，因为是多个用户对同一个账户取款，有共享资源（账户），因而使用Runnable接口实现。</p>
</li>
</ul>
<p>思路：创建银行账户类Account，创建取款线程AccountRunnable，创建测试类TestAccount，让2个用户同时取款</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 账户类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Account</span> </span>&#123;</span><br><span class="line">    <span class="comment">//余额</span></span><br><span class="line">    <span class="keyword">private</span> Integer balance = <span class="number">600</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getBalance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> balance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//取款操作</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">withDraw</span><span class="params">(<span class="keyword">int</span> money)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.balance = balance -money;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Account account = <span class="keyword">new</span> Account();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//取款操作</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//核心操作</span></span><br><span class="line">        <span class="keyword">if</span>(account.getBalance()&gt;=<span class="number">400</span>)&#123;</span><br><span class="line">            account.withDraw(<span class="number">400</span>);</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">"取款成功，当前余额："</span></span><br><span class="line">                    +account.getBalance());</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() +<span class="string">"余额不足,取款失败！当前余额："</span></span><br><span class="line">                    +account.getBalance());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//创建2个线程</span></span><br><span class="line">        Runnable a = <span class="keyword">new</span> AccountRunnable(); <span class="comment">//账户线程</span></span><br><span class="line">        Thread thread1 = <span class="keyword">new</span> Thread(a);</span><br><span class="line">        thread1.setName(<span class="string">"张三"</span>);</span><br><span class="line">        Thread thread2 = <span class="keyword">new</span> Thread(a);</span><br><span class="line">        thread2.setName(<span class="string">"张三妻子"</span>);</span><br><span class="line">        <span class="comment">//启动2个线程</span></span><br><span class="line">        thread1.start();</span><br><span class="line">        thread2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">------------------------------------</span><br><span class="line">张三取款成功，当前余额：<span class="number">200</span>				<span class="comment">//情况1</span></span><br><span class="line">张三妻子余额不足,取款失败！当前余额：<span class="number">200</span></span><br><span class="line">    </span><br><span class="line">张三妻子余额不足,取款失败！当前余额：<span class="number">200</span>	<span class="comment">//情况2</span></span><br><span class="line">张三取款成功，当前余额：<span class="number">200</span></span><br></pre></td></tr></table></figure>

<p>乍一看好像有点问题，取款成功和失败的顺序有点不大对，那我们使用sleep来放大一下安全问题：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Account account = <span class="keyword">new</span> Account();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//取款操作</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//核心操作</span></span><br><span class="line">        <span class="keyword">if</span>(account.getBalance()&gt;=<span class="number">400</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                sleep(<span class="number">1</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            account.withDraw(<span class="number">400</span>);</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">"取款成功，当前余额："</span></span><br><span class="line">                    +account.getBalance());</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() +<span class="string">"余额不足,取款失败！当前余额："</span></span><br><span class="line">                    +account.getBalance());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">------------------------------------</span><br><span class="line">张三妻子取款成功，当前余额：-<span class="number">200</span>	<span class="comment">//情况1</span></span><br><span class="line">张三取款成功，当前余额：-<span class="number">200</span></span><br><span class="line"></span><br><span class="line">张三妻子取款成功，当前余额：<span class="number">200</span>	<span class="comment">//情况2</span></span><br><span class="line">张三取款成功，当前余额：<span class="number">200</span></span><br></pre></td></tr></table></figure>

<p>居然都有负数！！！那么发生上述的问题该如何解决？</p>
<h2 id="同步代码块"><a href="#同步代码块" class="headerlink" title="同步代码块"></a>同步代码块</h2><p><code>synchronized（同步监视器）{同步代码块：可能出现安全隐患的代码}</code></p>
<blockquote>
<p>同步监视器（锁）的要求：</p>
<ul>
<li>必须是引用数据类型，不能是基本数据类型</li>
<li>在同步代码快中不能可以改变同步监视器的属性值，不能改变其引用（也就是说引用对象的属性值可以修改，但是不能将该引用指向其他对象）<ul>
<li>若自己无法保证修改，可以给同步监视器加上<strong>final</strong>关键字，这样即使在同步代码块中也会编译报错来提示。</li>
</ul>
</li>
<li>尽量不用String和Integer做同步监视器，若用了，要保证代码块中不对其操作<ul>
<li>String a=”hello”做同步监视器时，代码块中String a=”nihao”，相当于是改变了其引用，涉及到了常量池的引用</li>
<li>Integer a=1做同步监视器时，代码块中Integer a = 11,而常量池中有[-128，127]的引用，实际上是指向了常量池中2对应的引用</li>
</ul>
</li>
<li>一般使用共享资源做同步监视器就行了</li>
<li>也可以专门创建一个  没有任何业务含义的同步监视器</li>
<li><strong>建议使用final修饰同步监视器</strong></li>
</ul>
<p>总结下：同步监视器（3点）：<font color="red">必须是引用类型，可修改属性值不可修改引用，建议使用final修饰</font></p>
</blockquote>
<h3 id="同步代码块的执行过程"><a href="#同步代码块的执行过程" class="headerlink" title="同步代码块的执行过程"></a>同步代码块的执行过程</h3><blockquote>
<ul>
<li><p>线程1 获取到cpu，来到同步执行块，发现同步监视器open状态，需要先close，在执行其中的代码</p>
<p>（线程1看到锁是开的，先进入，再把锁锁上了，这样就它自己一个线程在里面了）</p>
</li>
<li><p>线程1在执行过程中，发生了线程切换（阻塞，就绪），线程1失去了cpu,但是没有开锁open，因此线程2也进入阻塞状态（线程1在屋子里，失去了cpu，但是线程2由于被锁在外面进不来，拿到cpu也无法使用，进入阻塞状态）</p>
</li>
<li><p>线程1再次获取到cpu，接着执行后续代码，等待同步代码块执行完毕，线程1释放锁open</p>
<p>（线程1做好了，开锁出去了）</p>
</li>
<li><p>线程2 再次获取到cpu，来到同步代码块，发现同步监视器open转台，重复线程1的处理过程</p>
<p>（上锁、执行、开锁）</p>
</li>
</ul>
</blockquote>
<p>将可能出现安全隐患的代码加入到同步代码块中</p>
<p>由于本例中只用到一个if else，无法分离。因此全部加进入。正常项目不会只会将可能出现安全隐患的代码加进去。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Account account = <span class="keyword">new</span> Account();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//取款操作</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//核心操作</span></span><br><span class="line">        <span class="keyword">synchronized</span> (account)&#123;</span><br><span class="line">            <span class="keyword">if</span>(account.getBalance()&gt;=<span class="number">400</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    sleep(<span class="number">1</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                account.withDraw(<span class="number">400</span>);</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">"取款成功，当前余额："</span></span><br><span class="line">                        +account.getBalance());</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() +<span class="string">"余额不足,取款失败！当前余额："</span></span><br><span class="line">                        +account.getBalance());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">----------------------------------------------</span><br><span class="line">张三取款成功，当前余额：<span class="number">200</span></span><br><span class="line">张三妻子余额不足,取款失败！当前余额：<span class="number">200</span></span><br></pre></td></tr></table></figure>

<h3 id="同步代码块的优缺点"><a href="#同步代码块的优缺点" class="headerlink" title="同步代码块的优缺点"></a>同步代码块的优缺点</h3><p>优点：安全</p>
<p>缺点：效率低 可能出现死锁</p>
<img style="zoom: 67%;" data-src="https://yanghanblog.oss-cn-hangzhou.aliyuncs.com/img/20191127170057.png" class="lozad">

<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p>多个代码块使用同一个同步监视器（锁），锁住一个代码块的同时，也锁住了所有使用该锁的所有代码块，其他线程无法访问其中的<strong>任何一个代码块</strong>。但是没有锁住使用其他同步监视器的代码块，其他线程有机会访问其他同步监视器的代码块</p>
<p><img alt data-src="https://yanghanblog.oss-cn-hangzhou.aliyuncs.com/img/20191127170922.png" class="lozad"></p>
<h2 id="同步方法"><a href="#同步方法" class="headerlink" title="同步方法"></a>同步方法</h2><p>关键字：synchronized</p>
<p>注意：不要将run方法设置为同步方法，那样run方法就变成单线程的了。（并行/并发—–&gt;串行）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Account account = <span class="keyword">new</span> Account();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//取款操作</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="comment">//核心操作</span></span><br><span class="line">        withDraw();</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">withDraw</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(account.getBalance()&gt;=<span class="number">400</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                sleep(<span class="number">1</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            account.withDraw(<span class="number">400</span>);</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">"取款成功，当前余额："</span></span><br><span class="line">                    +account.getBalance());</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() +<span class="string">"余额不足,取款失败！当前余额："</span></span><br><span class="line">                    +account.getBalance());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//创建2个线程</span></span><br><span class="line">        Runnable a = <span class="keyword">new</span> AccountRunnable(); <span class="comment">//账户线程</span></span><br><span class="line">        Thread thread1 = <span class="keyword">new</span> Thread(a);</span><br><span class="line">        thread1.setName(<span class="string">"张三"</span>);</span><br><span class="line">        Thread thread2 = <span class="keyword">new</span> Thread(a);</span><br><span class="line">        thread2.setName(<span class="string">"张三妻子"</span>);</span><br><span class="line">        <span class="comment">//启动2个线程</span></span><br><span class="line">        thread1.start();</span><br><span class="line">        thread2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-------------------------------------------------</span><br><span class="line">张三取款成功，当前余额：<span class="number">200</span></span><br><span class="line">张三妻子余额不足,取款失败！当前余额：<span class="number">200</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>同步代码块有自定义的同步监视器，那么同步方法有吗？</strong></p>
<p>有。同步方法的同步监视器是this,也就是当前的对象。也就是说，一旦一个同步方法被锁定，所有的同步方法都会被锁定。效率低下</p>
</blockquote>
<p><img alt data-src="https://yanghanblog.oss-cn-hangzhou.aliyuncs.com/img/20191127172128.png" class="lozad"></p>
<h2 id="Lock锁"><a href="#Lock锁" class="headerlink" title="Lock锁"></a>Lock锁</h2><p>JDK1.5提供了一个新的线程同步的方式。</p>
<p>java.util.concurrent.locks，我们需要用到并发包下的Locks的Lock接口</p>
<p><img alt data-src="https://yanghanblog.oss-cn-hangzhou.aliyuncs.com/img/20191127174209.png" class="lozad"></p>
<p>步骤：<code>买锁  ----  上锁  ----  开锁</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.young.thread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Lock;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.Thread.sleep;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 买锁</span></span><br><span class="line">    <span class="keyword">private</span> Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">    <span class="keyword">private</span> Account account = <span class="keyword">new</span> Account();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//取款操作</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="comment">//上锁</span></span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="comment">//核心操作</span></span><br><span class="line">        <span class="keyword">if</span>(account.getBalance()&gt;=<span class="number">400</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                sleep(<span class="number">1</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            account.withDraw(<span class="number">400</span>);</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">"取款成功，当前余额："</span></span><br><span class="line">                    +account.getBalance());</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() +<span class="string">"余额不足,取款失败！当前余额："</span></span><br><span class="line">                    +account.getBalance());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//开锁</span></span><br><span class="line">        lock.unlock();</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-----------------------------</span><br><span class="line">张三取款成功，当前余额：<span class="number">200</span></span><br><span class="line">张三妻子余额不足,取款失败！当前余额：<span class="number">200</span></span><br></pre></td></tr></table></figure>

<p>但这还是不够完整，若是同步代码发生异常，开锁的操作就不会执行，因此我们需要将 unlock() 加入 finally 来使开锁操作执行。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 买锁</span></span><br><span class="line">    <span class="keyword">private</span> Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">    <span class="keyword">private</span> Account account = <span class="keyword">new</span> Account();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//取款操作</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">//上锁</span></span><br><span class="line">            lock.lock();</span><br><span class="line">            <span class="comment">//核心操作</span></span><br><span class="line">            <span class="keyword">if</span>(account.getBalance()&gt;=<span class="number">400</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    sleep(<span class="number">1</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                account.withDraw(<span class="number">400</span>);</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">"取款成功，当前余额："</span></span><br><span class="line">                        +account.getBalance());</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() +<span class="string">"余额不足,取款失败！当前余额："</span></span><br><span class="line">                        +account.getBalance());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//开锁</span></span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因此，这个lock的流程：</p>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;      Lock l = ...; </span><br><span class="line">&gt;      l.lock();</span><br><span class="line">&gt;      try &#123;</span><br><span class="line">&gt;          // access the resource protected by this lock</span><br><span class="line">&gt;      &#125; finally &#123;</span><br><span class="line">&gt;          l.unlock();</span><br><span class="line">&gt;      &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="Lock-和-synchronized-的区别"><a href="#Lock-和-synchronized-的区别" class="headerlink" title="Lock 和 synchronized 的区别"></a>Lock 和 synchronized 的区别</h2><p>Lock 是 JDK5 后新增的功能。与采用 synchronized 相比，Lock可提供多种锁方案（多个实现类）。更加灵活</p>
<blockquote>
<p>Lock是显式锁（手动开启和关闭），synchronized是隐式锁</p>
<p>Lock只有代码块锁，synchronized有代码块锁和方法锁（lock只能锁代码，不能锁方法）</p>
<p>使用Lock锁，JVM将花费较少的时间来调度线程，性能更好，并且具有更好的扩展性（子类多）</p>
</blockquote>
<h2 id="优先使用顺序"><a href="#优先使用顺序" class="headerlink" title="优先使用顺序"></a>优先使用顺序</h2><p>Lock —- 同步代码块（已经进入方法体，分配了相应资源）   —– 同步方法（在方法体之外，还得另外分配资源）</p>
<h1 id="线程通信"><a href="#线程通信" class="headerlink" title="线程通信"></a>线程通信</h1><h2 id="生产者和消费者问题"><a href="#生产者和消费者问题" class="headerlink" title="生产者和消费者问题"></a>生产者和消费者问题</h2><blockquote>
<p>技能点：线程通信  wait()  notify()  notifyAll()  Object类中的public方法</p>
</blockquote>
<p><img alt data-src="https://yanghanblog.oss-cn-hangzhou.aliyuncs.com/img/20191127175341.png" class="lozad"></p>
<p>在上述例子中，要避免供过于求或供不应求。因此生产者和消费者之间要进行通信</p>
<p>分析：</p>
<ul>
<li>生产者 —– 仓库（只能放一件商品） —– 消费者</li>
<li>生产和消费交替进行</li>
<li>生产者交替生成白色馒头和黄色玉米饼</li>
</ul>
<p>注意：</p>
<ul>
<li>线程通信的前提是线程同步，因此需要线程同步来保证安全性</li>
<li>生产者线程和消费者线程是2个不同的线程</li>
<li>本例与取款的例子不同：取款的2个线程对象是做相同的操作，而本例的2个线程对象一个做生产，一个做消费</li>
<li>生产者线程和消费者线程需要相互通信（还没有商品吗？没有，告诉生产者生产吧）</li>
</ul>
<p>设计：</p>
<ul>
<li>定义商品类</li>
<li>定义生产者线程 消费者线程</li>
<li>定义测试类（创建线程对象并启动）</li>
</ul>
<p>第一个问题：实现相同锁</p>
<p>消费者获取到的产品名和产品颜色都是null</p>
<p>是因为他们获取到地不是同一个对象，因此要定义同一个对象，以参数的形式传递给生产者线程和消费者线程。</p>
<p>第二个问题：实现安全问题</p>
<p>当加入sleep方法后检查安全问题：</p>
<p>开始出现黄色馒头和白色玉米棒，这是因为没有线程同步，因此给生产者和消费者线程加上锁（同一把锁）</p>
<p>第三个问题：实现线程通信</p>
<p>生产者和消费者之间没有实现交替</p>
<p>调用同步监视器的wait()进行等待，调用同步监视器的notify()进行通知</p>
<p><strong>注意wait()和notify()要写在同步的代码中</strong>，否则会报IllegalMonitorStateException</p>
<p>一些细节：（属于Object类的方法）</p>
<p><code>wait()</code>:会进入【当前同步监控器】的【阻塞队列】，并【释放锁】。在其他线程调用此对象（同步监控器）的notify()或notifyAll()之前，都会处于线程等待状态（阻塞）</p>
<p>也就是说，当生产者发现仓库还有商品时，执行wait()进入了product的阻塞队列，并释放了锁，此时消费者抢占到CPU，拿到锁，进入了同步代码块，一看哟呵，有商品，因此没有进入wait()，而是直接消费商品，完后使用同一个监视器notify()通知（唤醒）处在阻塞队列的生产者，而后生产者继续执行未完的操作（不包括wait，因为wait已经执行完毕）</p>
<p><code>wait(time)</code>:会进入当前同步监控器的阻塞队列time秒，并释放锁。过了time秒后，即使【没被唤醒】，也会【自己醒】来。</p>
<p><code>notify()</code>:通知（唤醒）在【此对象监视器】上等待的【一个】线程。</p>
<p>此时若所有线程都在此对象上等待，则会【随机】选择【唤醒其中一个】线程。</p>
<p><code>notifyAll()</code>:通知（唤醒）在【此对象监视器】上等待的【所有】线程。</p>
<p>被唤醒的线程将以常规的方式与该对象上主动同步的其他线程【进行竞争】</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Product</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String color;</span><br><span class="line">    <span class="comment">// 商品标志 默认为没有商品</span></span><br><span class="line">    Boolean flag = <span class="keyword">false</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Product</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Product</span><span class="params">(String name, String color)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.color = color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getColor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setColor</span><span class="params">(String color)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.color = color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Product&#123;"</span> +</span><br><span class="line">                <span class="string">"name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", color='"</span> + color + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">======================================</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProduceRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//private Product product = new Product();</span></span><br><span class="line">    <span class="keyword">private</span> Product product = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ProduceRunnable</span><span class="params">(Product product)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.product = product;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Product <span class="title">getProduct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> product;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProduct</span><span class="params">(Product product)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.product = product;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (product)&#123;</span><br><span class="line">                <span class="comment">// 如果仓库有了商品，就等待</span></span><br><span class="line">                <span class="keyword">if</span>(product.flag)&#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        product.wait();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">//生产商品并输出结果</span></span><br><span class="line">                <span class="keyword">if</span>(i%<span class="number">2</span>==<span class="number">0</span>)&#123;</span><br><span class="line">                    product.setName(<span class="string">"馒头"</span>);</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        sleep(<span class="number">1</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    product.setColor(<span class="string">"白色"</span>);</span><br><span class="line">                &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                    product.setName(<span class="string">"玉米棒"</span>);</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        sleep(<span class="number">1</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                    product.setColor(<span class="string">"黄色"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(<span class="string">"生产者在生产..."</span>+product.getColor() +product.getName());</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 改变商品状态（商品做好了）</span></span><br><span class="line">                product.flag = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 通知消费者可以消费</span></span><br><span class="line">                product.notify();</span><br><span class="line">            &#125;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">===================================</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsumeRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//private Product product = new Product();</span></span><br><span class="line">    <span class="keyword">private</span> Product product = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ConsumeRunnable</span><span class="params">(Product product)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.product = product;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Product <span class="title">getProduct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> product;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProduct</span><span class="params">(Product product)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.product = product;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (product)&#123;</span><br><span class="line">                <span class="comment">//如若没有商品 ，就等待</span></span><br><span class="line">                <span class="keyword">if</span> (!product.flag)&#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        product.wait();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">//消费商品并输出结果</span></span><br><span class="line">                System.out.println(<span class="string">"消费者在消费商品..."</span>+product.getColor()+product.getName());</span><br><span class="line"></span><br><span class="line">                <span class="comment">//改变商品状态（没有商品了）</span></span><br><span class="line">                product.flag = <span class="keyword">false</span>;</span><br><span class="line">                <span class="comment">//通知生产者进行生产</span></span><br><span class="line">                product.notify();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">===============================</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Product product = <span class="keyword">new</span> Product();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建线程对象</span></span><br><span class="line">        Runnable r1 = <span class="keyword">new</span> ProduceRunnable(product);</span><br><span class="line">        Thread productor = <span class="keyword">new</span> Thread(r1);</span><br><span class="line"></span><br><span class="line">        Runnable r2 = <span class="keyword">new</span> ConsumeRunnable(product);</span><br><span class="line">        Thread consumer = <span class="keyword">new</span> Thread(r2);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//启动线程</span></span><br><span class="line">        productor.start();</span><br><span class="line">        consumer.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">=================================</span><br><span class="line">生产者在生产...白色馒头</span><br><span class="line">消费者在消费商品...白色馒头</span><br><span class="line">生产者在生产...黄色玉米棒</span><br><span class="line">消费者在消费商品...黄色玉米棒</span><br><span class="line">生产者在生产...白色馒头</span><br><span class="line">消费者在消费商品...白色馒头</span><br><span class="line">生产者在生产...黄色玉米棒</span><br><span class="line">消费者在消费商品...黄色玉米棒</span><br><span class="line">生产者在生产...白色馒头</span><br><span class="line">消费者在消费商品...白色馒头</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<h2 id="更完整的线程生命周期"><a href="#更完整的线程生命周期" class="headerlink" title="更完整的线程生命周期"></a>更完整的线程生命周期</h2><p><img alt data-src="https://yanghanblog.oss-cn-hangzhou.aliyuncs.com/img/20191127233402.png" class="lozad"></p>
<p><img alt data-src="https://yanghanblog.oss-cn-hangzhou.aliyuncs.com/img/20191128000900.png" class="lozad"></p>
<p><img alt data-src="https://yanghanblog.oss-cn-hangzhou.aliyuncs.com/img/20191128000617.png" class="lozad"></p>
<p><img alt data-src="https://yanghanblog.oss-cn-hangzhou.aliyuncs.com/img/20191128001416.png" class="lozad"></p>
<p>sleep与wait的异同</p>
<p>相同点：sleep和wait抛出的异常相同，都可以指定时间</p>
<p><img alt data-src="https://yanghanblog.oss-cn-hangzhou.aliyuncs.com/img/20191128002417.png" class="lozad"></p>
<p><img alt data-src="https://yanghanblog.oss-cn-hangzhou.aliyuncs.com/img/20191128002158.png" class="lozad"></p>
<h2 id="生产者-消费者（同步方法）"><a href="#生产者-消费者（同步方法）" class="headerlink" title="生产者 消费者（同步方法）"></a>生产者 消费者（同步方法）</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Product</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String color;</span><br><span class="line">    <span class="comment">// 商品标志 默认为没有商品</span></span><br><span class="line">    Boolean flag = <span class="keyword">false</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Product</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Product</span><span class="params">(String name, String color)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.color = color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getColor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setColor</span><span class="params">(String color)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.color = color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Product&#123;"</span> +</span><br><span class="line">                <span class="string">"name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", color='"</span> + color + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">produce</span><span class="params">(String name,String color)</span></span>&#123;  <span class="comment">//锁是this</span></span><br><span class="line">        <span class="comment">// 如果仓库有了商品，就等待</span></span><br><span class="line">        <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">this</span>.wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.color = color;</span><br><span class="line">        System.out.println(<span class="string">"生产者在生产..."</span>+getColor() +getName());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 改变商品状态（商品做好了）</span></span><br><span class="line">        flag = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 通知消费者可以消费</span></span><br><span class="line">        notify();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">consume</span><span class="params">()</span></span>&#123;     <span class="comment">//锁是this</span></span><br><span class="line"><span class="comment">//如若没有商品 ，就等待</span></span><br><span class="line">        <span class="keyword">if</span> (!flag)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">this</span>.wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//消费商品并输出结果</span></span><br><span class="line">        System.out.println(<span class="string">"消费者在消费商品..."</span>+name+color);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//改变商品状态（没有商品了）</span></span><br><span class="line">        flag = <span class="keyword">false</span>;</span><br><span class="line">        <span class="comment">//通知生产者进行生产</span></span><br><span class="line">        notify();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">==============================</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProduceRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//private Product product = new Product();</span></span><br><span class="line">    <span class="keyword">private</span> Product product = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ProduceRunnable</span><span class="params">(Product product)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.product = product;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Product <span class="title">getProduct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> product;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProduct</span><span class="params">(Product product)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.product = product;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i%<span class="number">2</span>==<span class="number">0</span>)&#123;</span><br><span class="line">                product.produce(<span class="string">"馒头"</span>,<span class="string">"白色"</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                product.produce(<span class="string">"玉米棒"</span>,<span class="string">"黄色"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">==============================    </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsumeRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//private Product product = new Product();</span></span><br><span class="line">    <span class="keyword">private</span> Product product = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ConsumeRunnable</span><span class="params">(Product product)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.product = product;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Product <span class="title">getProduct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> product;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProduct</span><span class="params">(Product product)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.product = product;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line">            product.consume();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">==============================</span><br><span class="line">生产者在生产...黄色玉米棒</span><br><span class="line">消费者在消费商品...玉米棒黄色</span><br><span class="line">生产者在生产...白色馒头</span><br><span class="line">消费者在消费商品...馒头白色</span><br><span class="line">生产者在生产...黄色玉米棒</span><br><span class="line">消费者在消费商品...玉米棒黄色</span><br><span class="line">生产者在生产...白色馒头</span><br><span class="line">消费者在消费商品...馒头白色</span><br><span class="line">生产者在生产...黄色玉米棒</span><br><span class="line">消费者在消费商品...玉米棒黄色</span><br></pre></td></tr></table></figure>

</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">杨涵</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://cometorbityh.github.io/2019/11/26/JAVA-多线程：1/">https://cometorbityh.github.io/2019/11/26/JAVA-多线程：1/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://cometorbityh.github.io">MY</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/Photo/avatar.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button"><i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lozad post-qr-code__img" src="/img/wechat.jpg"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lozad post-qr-code__img" src="/img/alipay.jpg"><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="next-post pull-full"><a href="/2019/11/25/数据库/"><img class="next_cover lozad" data-src="https://yanghanblog.oss-cn-hangzhou.aliyuncs.com/img/20191126231814.jpg" onerror="onerror=null;src='/img/comment_bg.png'"><div class="label">下一篇</div><div class="next_info"><span>数据库</span></div></a></div></nav></div></div><footer><div id="footer"><div class="copyright">&copy;2018 - 2019 By 杨涵</div><div class="framework-info"><span>驱动 </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换">繁</a><i class="nightshift fa fa-moon-o" id="nightshift" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="/js/third-party/fireworks.js"></script><script src="/js/nightshift.js"></script><script src="/js/tw_cn.js"></script><script>translateInitilization()

</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@1.2.2/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script><script>const observer = lozad(); // lazy loads elements with default selector as '.lozad'
observer.observe();
</script></body></html>